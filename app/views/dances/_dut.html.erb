<% duts = Dut.where(tag: _tag, dance: dance) %>
<% dut = duts.find_by(user: user) %>
<% duts_count = duts.count %>
<% other_duts_count = duts_count - (dut ? 1 : 0) %>
<%= content_tag(:div, class: "tag-constellation", 'data-tag-id': _tag.id) do %>
  <%= content_tag(:span, '', class: "glyphicon #{_tag.glyphicon} #{duts_count > 0 ? '' : 'invisible'} #{_tag.bootstrap_color ? ('text-'+_tag.bootstrap_color) : ''}") %>
  <%= content_tag :span, _tag.name, class: "tag-label#{duts_count == 0 ? ' tag-label-untagged' : ''}"  %>
  Ã— <%= content_tag :span, duts.count.to_s, class: 'tag-multiplier', 'data-other-user-count': other_duts_count %>

<!-- <input type="checkbox" data-remote="true" -->
<!--     data-url="/update" data-params="id=10" data-method="put"> -->

  <%# tag(:input, {type: :checkbox, 'data-toggle': :toggle, checked: !!dut, 'data-remote': true, 'data-url': '/duts', 'data-method': 'post', 'data-params': {dance_id: dance.id, tag_id: _tag.id}.to_query}.merge(_tag.bootstrap_color? ? {'data-onstyle': _tag.bootstrap_color} : {})) %>

  <%= check_box_tag('checked', 'yeah', !!dut, {'data-toggle': :toggle, data: {url: '/duts', remote: true, method: :post, params: {dance_id: dance.id, tag_id: _tag.id}.to_query}}.merge(_tag.bootstrap_color? ? {'data-onstyle': _tag.bootstrap_color} : {})) %>
  <%= content_tag :span, _tag.documentation(other_count: other_duts_count, me: false), class: 'off-sentence', style: (dut ? 'display: none;' : '') %>

  <%= content_tag :span, _tag.documentation(other_count: other_duts_count, me: true), class: 'on-sentence', style: (dut ? '' : 'display: none;') %>
<% end %>
<br />
